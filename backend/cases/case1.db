-- Case metadata
CREATE TABLE case_metadata (
    title TEXT,
    description TEXT,
    starting_clue TEXT,
    difficulty TEXT,
    required_concept TEXT
);

INSERT INTO case_metadata VALUES (
    'The Missing Artifact',
    'A valuable artifact has gone missing from the museum. Use SQL to find clues in the employee records and security logs.',
    'The artifact was last seen in the Egyptian exhibit on the night of the theft. Check the security logs for that night.',
    'beginner',
    'SELECT with WHERE clause'
);

-- Suspects table
CREATE TABLE suspects (
    id INTEGER PRIMARY KEY,
    name TEXT,
    position TEXT,
    alibi TEXT,
    access_level INTEGER
);

INSERT INTO suspects VALUES 
    (1, 'John Smith', 'Security Guard', 'Was patrolling the west wing', 2),
    (2, 'Emily Davis', 'Curator', 'Was at home sick', 3),
    (3, 'Michael Johnson', 'Janitor', 'Cleaning the basement', 1),
    (4, 'Sarah Wilson', 'Tour Guide', 'Leading a private tour', 2);

-- Security logs table
CREATE TABLE security_logs (
    id INTEGER PRIMARY KEY,
    timestamp TEXT,
    location TEXT,
    event_type TEXT,
    employee_id INTEGER
);

INSERT INTO security_logs VALUES
    (1, '2023-05-15 20:15:00', 'Egyptian Exhibit', 'Door opened', 1),
    (2, '2023-05-15 20:30:00', 'Egyptian Exhibit', 'Motion detected', NULL),
    (3, '2023-05-15 21:00:00', 'Main Hall', 'Door opened', 4),
    (4, '2023-05-15 21:15:00', 'Storage Room', 'Door opened', 2);

-- Clues table for clue progression
CREATE TABLE IF NOT EXISTS clues (
    clue_index INTEGER PRIMARY KEY,
    text TEXT,
    expected_query TEXT,
    expected_result TEXT,
    hint TEXT
);

INSERT OR IGNORE INTO clues (clue_index, text, expected_query, expected_result, hint) VALUES
    (0, 'Check the security logs for the Egyptian Exhibit on the night of the theft.', 'SELECT * FROM security_logs WHERE location = "Egyptian Exhibit"', NULL, 'Check the security logs for the Egyptian Exhibit on the night of the theft.'),
    (1, 'Look for employees who were present in the museum at the time of the theft.', 'SELECT * FROM suspects WHERE name IN (SELECT employee_id FROM security_logs WHERE location = "Egyptian Exhibit")', NULL, 'Look for employees who were present in the museum at the time of the theft.'),
    (2, 'Try joining the suspects and security logs tables to find connections.', 'SELECT s.name, l.timestamp FROM suspects s JOIN security_logs l ON s.id = l.employee_id', NULL, 'Try joining the suspects and security logs tables to find connections.');

ALTER TABLE clues ADD COLUMN hint TEXT;

UPDATE clues SET hint = 'Check the security logs for the Egyptian Exhibit on the night of the theft.' WHERE clue_index = 0;
UPDATE clues SET hint = 'Look for employees who were present in the museum at the time of the theft.' WHERE clue_index = 1;
UPDATE clues SET hint = 'Try joining the suspects and security logs tables to find connections.' WHERE clue_index = 2;